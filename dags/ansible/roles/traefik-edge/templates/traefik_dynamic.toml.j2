[tcp]
  # ----------------------------------------------------------------
  # HTTP Traffic (Port 80)
  # Forward all traffic on Port 80 to the Workers' Port 80
  # ----------------------------------------------------------------
  [tcp.routers.to-k3s-http]
    entryPoints = ["web"]
    rule = "HostSNI(`*`)"
    service = "k3s-workers-http"

  [tcp.services.k3s-workers-http.loadBalancer]
    [[tcp.services.k3s-workers-http.loadBalancer.servers]]
    {% for host in groups['k3s_workers'] %}
      address = "{{ hostvars[host]['ansible_host'] }}:80"
    {% endfor %}

  # ----------------------------------------------------------------
  # HTTPS Traffic (Port 443)
  # Forward all traffic on Port 443 to the Workers' Port 443
  # ----------------------------------------------------------------
  [tcp.routers.to-k3s-https]
    entryPoints = ["websecure"]
    rule = "HostSNI(`*`)"
    service = "k3s-workers-https"

  [tcp.services.k3s-workers-https.loadBalancer]
    [[tcp.services.k3s-workers-https.loadBalancer.servers]]
    {% for host in groups['k3s_workers'] %}
      address = "{{ hostvars[host]['ansible_host'] }}:443"
    {% endfor %}